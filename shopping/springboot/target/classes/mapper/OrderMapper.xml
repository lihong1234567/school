<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.dao.OrderDao">

    <select id="findBySearch" resultType="com.example.entity.Order">
        select `orderInfo`.*,
               `user`.`username` as `userName`,
               `goods`.`telePhone` as `releasePhone`
        from `orderInfo`
        left join `user` on `orderInfo`.`userId` = `user`.id
        left join `goods` on `orderInfo`.`goodsId` = `goods`.id
        where 1 = 1
        <if test="search != null and search.orderId != null and search.orderId != ''">
            and `orderInfo`.`orderId` = #{search.orderId}
        </if>
        <if test="search != null and search.releaseUser != null and search.releaseUser != ''">
            and `orderInfo`.`releaseUser` = #{search.releaseUser}
        </if>
        <if test="role != null and role == 2">
            and `orderInfo`.`userId` = #{userId}
        </if>
    </select>
    <select id="findByMonAll" resultType="com.example.entity.Order">
        select `orderInfo`.*,SUBSTRING(paytime, 6, 2) AS month
        from `orderInfo`
        order by `orderInfo`.`paytime` asc
    </select>
    <select id="findBySexAll" resultType="com.example.entity.Order">
        select `orderInfo`.*,
               `user`.`sex` as `sex`
        from `orderInfo`
                 left join `user` on `orderInfo`.`userId` = `user`.id
    </select>

</mapper>